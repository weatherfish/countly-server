<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
   ______                  __  __
  / ____/___  __  ______  / /_/ /_  __
 / /   / __ \/ / / / __ \/ __/ / / / /
/ /___/ /_/ / /_/ / / / / /_/ / /_/ /
\____/\____/\__,_/_/ /_/\__/_/\__, /
              http://count.ly/____/
-->
<html>
<head> 
	<title>Countly</title> 
	<meta name="viewport" content="width=device-width, user-scalable=0, maximum-scale=1.0">
	<link rel="icon" type="image/png" href="<%- cdn %>images/favicon.png">
    <link rel="stylesheet" href="<%- cdn %>stylesheets/font-awesome/css/font-awesome.min.css" />
	<link rel="stylesheet" href="<%- cdn %>stylesheets/entypo/css/entypo.css" />
    <link rel="stylesheet" href="<%- cdn %>stylesheets/ionicons/css/ionicons.min.css" />
	<link rel="stylesheet" href="<%- cdn %>javascripts/dom/jqueryui/jquery.ui.base.css" />
	<link rel="stylesheet" href="<%- cdn %>javascripts/dom/jqueryui/jquery.ui.theme.css" />
    <link rel="stylesheet" href="<%- cdn %>stylesheets/main.min.css?<%= countlyVersion %>" />
    <link rel="stylesheet" href="<%- cdn %>crashes/stylesheets/main.css?<%= countlyVersion %>" />
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/min/countly.dom.js?<%= countlyVersion %>"></script>
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/utils/handlebars.js?<%= countlyVersion %>"></script>
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/utils/jquery.i18n.properties-min-1.0.9.js?<%= countlyVersion %>"></script>
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/utils/underscore-min.js?<%= countlyVersion %>"></script>
    <style>
        #content-container { margin: 0; position: relative; }
        #content { padding: 0; position: relative; }
        .back-link { display: none; }
        #countly-promo { text-align: center; padding: 20px; border: 1px solid #d0d0d0; margin: 16px; border-radius: 2px; background-color: #FFF; margin-bottom: 0; color: #2FA732; font-size: 15px; font-weight: 100; }
    </style>
</head>
<body> 
    <h3 id="countly-promo">This crash report is generated by Countly. Get your own Countly Analytics and Marketing Platform <a href="https://count.ly" target="_blank" style="text-decoration: underline;">here</a>.</h3>
	<div id="overlay"></div>
    <div id="cly-resource" class="dialog black" style="max-width: 800px; max-height: 600px;">
        <div class="content"></div>
    </div>
	<div id="cly-popup" class="dialog black">
		<div class="indicator"></div>
		<div class="content"></div>
	</div>
	<div id="cly-loading" class="dialog black"> 
 		<div class="indicator"></div> 
 		<div class="message"></div> 
 		<div class="content"></div>
 	</div> 
	<div id="cly-alert" class="dialog">
		<div class="indicator"></div>
		<div class="message"></div>
		<div class="buttons">
				<a id="dialog-ok" class="icon-button light" data-localize="common.ok"></a>
		</div>
	</div>
	<div id="cly-confirm" class="dialog">
		<div class="indicator"></div>
		<div class="message"></div>
		<div class="buttons">
				<a id="dialog-continue" class="icon-button light" data-localize="common.continue"></a>
				<a id="dialog-cancel" class="icon-button light" data-localize="common.cancel"></a>
		</div>
	</div>
    <div id="content-container">
        <div id="content-top"></div>
        <div id="content"></div>
    </div>
    <script>
    window.countlyGlobal = window.countlyGlobal || {};
    countlyGlobal["path"] = "<%- path %>";
    countlyGlobal["cdn"] = "<%- cdn %>";
    countlyCommon = {};
    countlyCommon.ACTIVE_APP_KEY = 0;
    countlyCommon.ACTIVE_APP_ID = 0;
    countlyCommon.BROWSER_LANG = jQuery.i18n.browserLang() || "en-US";
    countlyCommon.BROWSER_LANG_SHORT = countlyCommon.BROWSER_LANG.split("-")[0];
    countlyCommon.timeString = function(timespent){
        var timeSpentString = (timespent.toFixed(1)) + " " + jQuery.i18n.map["common.minute.abrv"];

        if (timespent >= 142560) {
            timeSpentString = (timespent / 525600).toFixed(1) + " " + jQuery.i18n.map["common.year.abrv"];
        } else if (timespent >= 1440) {
            timeSpentString = (timespent / 1440).toFixed(1) + " " + jQuery.i18n.map["common.day.abrv"];
        } else if (timespent >= 60) {
            timeSpentString = (timespent / 60).toFixed(1) + " " + jQuery.i18n.map["common.hour.abrv"];
        }
        return timeSpentString;
    };
    countlyCommon.drawGraph = function (dataPoints, container, graphType, inGraphProperties) {
        _.defer(function(){
            if ((!dataPoints.dp || !dataPoints.dp.length) || (graphType == "bar" && dataPoints.dp[0].data[0][1]== null && dataPoints.dp[0].data[1][1] == null)) {
                $(container).hide();
                $(container).siblings(".no-data").show();
                return true;
            } else {
                $(container).show();
                $(container).siblings(".no-data").hide();
            }

            var graphProperties = {
                series:{
                    lines:{ show:true, fill:true },
                    points:{ show:true }
                },
                grid:{ hoverable:true, borderColor:"null", color:"#999", borderWidth:0, minBorderMargin:10},
                xaxis:{ minTickSize:1, tickDecimals:"number", tickLength:0},
                yaxis:{ min:0, minTickSize:1, tickDecimals:"number", position:"right" },
                legend:{ backgroundOpacity:0, margin:[20, -19] },
                colors:countlyCommon.GRAPH_COLORS
            };

            switch (graphType) {
                case "line":
                    graphProperties.series = {lines:{ show:true, fill:true }, points:{ show:true }};
                    break;
                case "bar":
                    if (dataPoints.ticks.length > 20) {
                        graphProperties.xaxis.rotateTicks = 45;
                    }

                    var barWidth = 0.6;

                    switch(dataPoints.dp.length) {
                        case 2:
                            barWidth = 0.3;
                            break;
                        case 3:
                            barWidth = 0.2;
                            break;
                    }

                    for (var i = 0; i < dataPoints.dp.length; i++) {
                        dataPoints.dp[i].bars = {
                            order: i,
                            barWidth: barWidth
                        }
                    }

                    graphProperties.series = {stack:true, bars:{ show:true, barWidth:0.6, tickLength:0, fill:1 }};
                    graphProperties.xaxis.ticks = dataPoints.ticks;
                    break;
                case "separate-bar":
                    if (dataPoints.ticks.length > 20) {
                        graphProperties.xaxis.rotateTicks = 45;
                    }
                    graphProperties.series = {bars:{ show:true, align:"center", barWidth:0.6 }};
                    graphProperties.xaxis.ticks = dataPoints.ticks;
                    break;
                case "pie":
                    graphProperties.series = { pie:{
                        show:true,
                        lineWidth:0,
                        radius:115,
                        innerRadius: 0.45,
                        combine:{
                            color:'#CCC',
                            threshold:0.05
                        },
                        label:{
                            show:true,
                            radius:160
                        }
                    }};
                    graphProperties.legend.show = false;
                    break;
                default:
                    break;
            }

            if (inGraphProperties) {
                $.extend(true, graphProperties, inGraphProperties);
            }

            $.plot($(container), dataPoints.dp, graphProperties);

            if (graphType == "bar" || graphType == "separate-bar") {
                $(container).unbind("plothover");
                $(container).bind("plothover", function (event, pos, item) {
                    $("#graph-tooltip").remove();

                    if (item && item.datapoint && item.datapoint[1]) {
                        // For stacked bar chart calculate the diff
                        var yAxisValue = item.datapoint[1].toFixed(1).replace(".0", "") - item.datapoint[2].toFixed(1).replace(".0", "");

                        showTooltip({
                            x: pos.pageX,
                            y: item.pageY,
                            contents: yAxisValue || 0
                        });
                    }
                });
            } else {
                $(container).unbind("plothover");
            }
        }, dataPoints, container, graphType, inGraphProperties);
    };
    countlyCommon.formatTimeAgo = function(timestamp) {
		var target = new Date(timestamp*1000);
		var now = new Date();
		var diff = Math.floor((now - target) / 1000);
		if (diff <= 1) {return "<span style='color:#50C354;'>just now</span>";}
		if (diff < 20) {return "<span style='color:#50C354;'>" + diff + " seconds ago</span>";}
		if (diff < 40) {return "<span style='color:#50C354;'>half a minute ago</span>";}
		if (diff < 60) {return "<span style='color:#50C354;'>less than a minute ago</span>";}
		if (diff <= 90) {return "one minute ago";}
		if (diff <= 3540) {return Math.round(diff / 60) + " minutes ago";}
		if (diff <= 5400) {return "1 hour ago";}
		if (diff <= 86400) {return Math.round(diff / 3600) + " hours ago";}
		if (diff <= 129600) {return "1 day ago";}
		if (diff < 604800) {return Math.round(diff / 86400) + " days ago";}
		if (diff <= 777600) {return "1 week ago";}
		return "on " + target.toString().split(" GMT")[0];
	};
    jQuery.i18n.properties({
        name:'locale',
        cache:true,
        language:countlyCommon.BROWSER_LANG_SHORT,
        path:[countlyGlobal["cdn"]+'localization/min/'],
        mode:'map'
    });
    Handlebars.registerHelper('getFormattedNumber', function (context, options) {
        if (isNaN(context)) {
            return context;
        }

        ret = parseFloat((parseFloat(context).toFixed(2)).toString()).toString();
        return ret.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    });
    Handlebars.registerHelper('eachOfObject', function (context, options) {
        var ret = "";
        for (var prop in context) {
            ret = ret + options.fn({property:prop, value:context[prop]});
        }
        return ret;
    });
    CountlyHelpers = {};
    CountlyHelpers.initializeSelect = function (element) {
        element = element || $("#content-container");
        element.off("click", ".cly-select").on("click", ".cly-select", function (e) {
            if ($(this).hasClass("disabled")) {
                return true;
            }

            $(this).removeClass("req");

            var selectItems = $(this).find(".select-items"),
                itemCount = selectItems.find(".item").length;

            if (!selectItems.length) {
                return false;
            }

            $(".cly-select").find(".search").remove();

            if (selectItems.is(":visible")) {
                $(this).removeClass("active");
            } else {
                $(".cly-select").removeClass("active");
                $(".select-items").hide();
                $(this).addClass("active");

                if (itemCount > 10 && !$(this).hasClass("centered")) {
                    $("<div class='search'><div class='inner'><input type='text' /><i class='fa fa-search'></i></div></div>").insertBefore($(this).find(".select-items"));
                }
            }

            if ($(this).hasClass("centered")) {
                var height = $(this).find(".select-items").height();
                $(this).find(".select-items").css("margin-top", (-(height/2).toFixed(0) - ($(this).height()/2).toFixed(0)) + "px");
            }

            if ($(this).find(".select-items").is(":visible")) {
                $(this).find(".select-items").hide();
            } else {
                $(this).find(".select-items").show();
                $(this).find(".select-items>div").addClass("scroll-list");
                $(this).find(".scroll-list").slimScroll({
                    height:'100%',
                    start:'top',
                    wheelStep:10,
                    position:'right',
                    disableFadeOut:true
                });
            }

            $(this).find(".search input").focus();

            $("#date-picker").hide();
            e.stopPropagation();
        });

        element.off("click", ".select-items .item").on("click", ".select-items .item", function () {
            var selectedItem = $(this).parents(".cly-select").find(".text");
            selectedItem.text($(this).text());
            selectedItem.data("value", $(this).data("value"));
        });

        element.off("click", ".cly-select .search").on("click", ".cly-select .search", function (e) {
            e.stopPropagation();
        });

        element.off("keyup", ".cly-select .search input").on("keyup", ".cly-select .search input", function(event) {
            if (!$(this).val()) {
                $(this).parents(".cly-select").find(".item").removeClass("hidden");
            } else {
                $(this).parents(".cly-select").find(".item:not(:contains('" + $(this).val() + "'))").addClass("hidden");
                $(this).parents(".cly-select").find(".item:contains('" + $(this).val() + "')").removeClass("hidden");
            }
        });

        element.off('mouseenter').on('mouseenter', ".cly-select .item", function () {
            var item = $(this);

            if (this.offsetWidth < this.scrollWidth && !item.attr('title')) {
                item.attr('title', item.text());
            }
        });

        $(window).click(function () {
            $(".select-items").hide();
            $(".cly-select").find(".search").remove();
        });
    };
    CountlyHelpers.expandRows = function(dTable, getData){
		dTable.aOpen = [];
		dTable.on("click", "tr", function (e){
			var nTr = this;
			var id = $(nTr).attr("id");
			if(!id){
				e.stopPropagation();
			}
			else{
				var i = $.inArray( id, dTable.aOpen );
			
				if ( i === -1 ) {
					$(nTr).addClass("selected");
					var nDetailsRow = dTable.fnOpen( nTr, getData(dTable.fnGetData( nTr )), 'details' );
					$('div.datatablesubrow', nDetailsRow).slideDown();
					dTable.aOpen.push( id );
				}
				else {
					$(nTr).removeClass("selected");
					$('div.datatablesubrow', $(nTr).next()[0]).slideUp( function () {
						dTable.fnClose( nTr );
						dTable.aOpen.splice( i, 1 );
					} );
				}
			}
		});
	};
    CountlyHelpers.initializeSelect();
    function showTooltip(args) {
        var x = args.x || 0,
                y = args.y || 0,
                contents = args.contents,
                title = args.title,
                notes = args.notes;

        var tooltip = $('<div id="graph-tooltip" class="v2"></div>').append('<span class="content">' + contents + '</span>');

        if (title) {
            tooltip.prepend('<span id="graph-tooltip-title">' + title + '</span>');
        }

        if (notes) {
            var noteLines = (notes + "").split("===");

            for (var i = 0; i < noteLines.length; i++) {
                tooltip.append("<div class='note-line'>&#8211;  " + noteLines[i] + "</div>");
            }
        }

        $("#content").append("<div id='tooltip-calc'>" + $('<div>').append(tooltip.clone()).html() + "</div>");
        var widthVal = $("#graph-tooltip").outerWidth(),
                heightVal = $("#graph-tooltip").outerHeight();
        $("#tooltip-calc").remove();

        var newLeft = (x - (widthVal / 2)),
                xReach = (x + (widthVal / 2));

        if (notes) {
            newLeft += 10.5;
            xReach += 10.5;
        }

        if (xReach > $(window).width()) {
            newLeft = (x - widthVal);
        } else if (xReach < 340) {
            newLeft = x;
        }

        tooltip.css({
            top: y - heightVal - 20,
            left: newLeft
        }).appendTo("body").show();
    }
    function localize() {

        var helpers = {
            onlyFirstUpper:function (str) {
                return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
            },
            upper:function (str) {
                return str.toUpperCase();
            }
        };

        // translate help module
        $("[data-help-localize]").each(function () {
            var elem = $(this);
            if (elem.data("help-localize") != undefined) {
                elem.data("help", jQuery.i18n.map[elem.data("help-localize")]);
            }
        });

        // translate dashboard
        $("[data-localize]").each(function () {
            var elem = $(this),
                toLocal = elem.data("localize").split("!"),
                localizedValue = "";

            if (toLocal.length == 2) {
                if (helpers[toLocal[0]]) {
                    localizedValue = helpers[toLocal[0]](jQuery.i18n.map[toLocal[1]]);
                } else {
                    localizedValue = jQuery.i18n.prop(toLocal[0], jQuery.i18n.map[toLocal[1]]);
                }
            } else {
                localizedValue = jQuery.i18n.map[elem.data("localize")];
            }

            if (elem.is("input[type=text]") || elem.is("input[type=password]") || elem.is("textarea")) {
                elem.attr("placeholder", localizedValue);
            } else if (elem.is("input[type=button]") || elem.is("input[type=submit]")) {
                elem.attr("value", localizedValue);
            } else {
                elem.text(localizedValue);
            }
        });
    };
    </script>
	<script language="javascript" type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/countly/countly.config.js?<%= countlyVersion %>"></script>
    <script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/countly/countly.device.list.js?<%= countlyVersion %>"></script>
	<script language="javascript" type="text/javascript" src="<%- cdn %>javascripts/min/countly.visualization.js?<%= countlyVersion %>"></script>
	<script language="javascript" type="text/javascript" src="<%- cdn %>crashes/javascripts/countly.models.js?<%= countlyVersion %>"></script>
	<script>
    var data = <%-JSON.stringify(data)%>;
window.CrashgroupView = {
    beforeRender: function() {
		var self = this;
		return $.when($.get(countlyGlobal["path"]+'/crashes/templates/crashgroup.html', function(src){
			self.template = Handlebars.compile(src);
		})).then(function () {self.renderCommon()});
    },
    renderCommon:function (isRefresh) {

        var crashData = countlyCrashes.getGroupData();
		crashData.latest_version = crashData.latest_version.replace(/:/g, '.');
		this.metrics = countlyCrashes.getMetrics();
		this.curMetric = "os_version";
		this.curTitle = jQuery.i18n.map["crashes.os_version"];

        this.templateData = {
            "page-title":jQuery.i18n.map["crashes.crashes-by"],
            "note-placeholder": jQuery.i18n.map["crashes.editnote"],
			"data":crashData,
            "external": true,
			"error":crashData.name,
            "fatal": (crashData.nonfatal) ? jQuery.i18n.map["crashes.nonfatal"] : jQuery.i18n.map["crashes.fatal"],
			"active-segmentation": this.curTitle,
			"segmentations": this.metrics,
			"big-numbers":{
                "class":"four-column",
                "items":[
					{
                        "title":jQuery.i18n.map["crashes.platform"],
                        "total":crashData.os,
                        "help":"crashes.help-platform"
                    },
                    {
                        "title":jQuery.i18n.map["crashes.reports"],
                        "total":crashData.reports,
                        "help":"crashes.help-reports"
                    },
					{
                        "title":jQuery.i18n.map["crashes.highest-version"],
                        "total":crashData.latest_version.replace(/:/g, '.'),
                        "help":"crashes.help-app-version"
                    }
                ]
            },
			"ranges":[
				{
                    "title":jQuery.i18n.map["crashes.ram"],
					"icon":"crash-icon ram-icon",
                    "help":"crashes.help-ram",
                    "min":crashData.ram.min+" %",
                    "max":crashData.ram.max+" %",
                    "avg":(crashData.ram.total/crashData.ram.count).toFixed(2)+" %"
                },
				{
                    "title":jQuery.i18n.map["crashes.disk"],
					"icon":"crash-icon disk-icon",
                    "help":"crashes.help-disk",
                    "min":crashData.disk.min+" %",
                    "max":crashData.disk.max+" %",
                    "avg":(crashData.disk.total/crashData.disk.count).toFixed(2)+" %"
                },
				{
                    "title":jQuery.i18n.map["crashes.battery"],
					"icon":"crash-icon battery-icon",
                    "help":"crashes.help-battery",
                    "min":crashData.bat.min+" %",
                    "max":crashData.bat.max+" %",
                    "avg":(crashData.bat.total/crashData.bat.count).toFixed(2)+" %"
                },
				{
                    "title":jQuery.i18n.map["crashes.run"],
					"icon":"font-icon fa fa-youtube-play",
                    "help":"crashes.help-run",
                    "min":countlyCommon.timeString(crashData.run.min/60),
                    "max":countlyCommon.timeString(crashData.run.max/60),
                    "avg":countlyCommon.timeString((crashData.run.total/crashData.run.count)/60)
                }
            ],
            "bars":[
                {
                    "title":jQuery.i18n.map["crashes.root"],
                    "data": countlyCrashes.getBoolBars("root"),
                    "help":"crashes.help-root"
                },
				{
                    "title":jQuery.i18n.map["crashes.online"],
                    "data":countlyCrashes.getBoolBars("online"),
                    "help":"crashes.help-online"
                },
                {
                    "title":jQuery.i18n.map["crashes.muted"],
                    "data": countlyCrashes.getBoolBars("muted"),
                    "help":"crashes.help-muted"
                },
				{
                    "title":jQuery.i18n.map["crashes.background"],
                    "data": countlyCrashes.getBoolBars("background"),
                    "help":"crashes.help-background"
                }
            ]
        };
        if(crashData.users){
            this.templateData["big-numbers"]["items"].push({
                "title":jQuery.i18n.map["crashes.affected-users"],
                "total":crashData.users + " ("+((crashData.users/crashData.total)*100).toFixed(2)+"%)",
                "help":"crashes.help-affected"
            });
        }
        if(crashData.loss){
            this.templateData["loss"] = true;
            this.templateData["big-numbers"]["items"].push({
                "title":jQuery.i18n.map["crashes.loss"],
                "total":crashData.loss,
                "help":"crashes.help-loss"
            });
        }
        if(this.templateData["big-numbers"]["items"].length == 3)
            this.templateData["big-numbers"]["class"] = "three-column";
        else if(this.templateData["big-numbers"]["items"].length == 5)
            this.templateData["big-numbers"]["class"] = "five-column";
        if(crashData.session){
            this.templateData["frequency"] = true;
            this.templateData["ranges"].push({
                "title":jQuery.i18n.map["crashes.sessions"],
				"icon":"font-icon fa fa-refresh",
                "help":"crashes.help-frequency",
                "min":crashData.session.min,
                "max":crashData.session.max,
                "avg":((Math.round(crashData.session.total/crashData.session.count)*100)/100)
            });
        }
        $('#content').html(this.template(this.templateData));
        var self = this;
        $(".segmentation-option").on("click", function () {
			self.switchMetric($(this).data("value"));
		});
        if(crashData.data){
            this.dtable = $('.d-table').dataTable($.extend({}, $.fn.dataTable.defaults, {
                "aaData": crashData.data,
				"fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
					$(nRow).attr("id", aData._id);
				},
                "aoColumns": [
					{ "mData": function(row, type){if(type == "display") return countlyCommon.formatTimeAgo(row.ts); else return row.ts;}, "sType":"string", "sTitle": jQuery.i18n.map["crashes.crashed"]},
					{ "mData": function(row, type){return row.os + " " + row.os_version.replace(/:/g, '.');}, "sType":"string", "sTitle": jQuery.i18n.map["crashes.os_version"] },
					{ "mData": function(row, type){return row.manufacture + " " + row.device;}, "sType":"string", "sTitle": jQuery.i18n.map["crashes.platform"]},
					{ "mData": function(row, type){return row.app_version.replace(/:/g, '.');}, "sType":"string", "sTitle": jQuery.i18n.map["crashes.app_version"] }
                ]
            }));
			this.dtable.stickyTableHeaders();
			this.dtable.fnSort( [ [0,'desc'] ] );
			CountlyHelpers.expandRows(this.dtable, this.formatData);
        }
		countlyCommon.drawGraph(crashData.dp[this.curMetric], "#dashboard-graph", "bar");
        localize();
        $('.help-zone-vb').tipsy({gravity:$.fn.tipsy.autoNS, trigger:'manual', title:function () {
            return ($(this).data("help")) ? $(this).data("help") : "";
        }, fade:true, offset:5, cssClass:'yellow', opacity:1, html:true});
        $('.help-zone-vs').tipsy({gravity:$.fn.tipsy.autoNS, trigger:'manual', title:function () {
            return ($(this).data("help")) ? $(this).data("help") : "";
        }, fade:true, offset:5, cssClass:'yellow narrow', opacity:1, html:true});
        $(".help-zone-vs, .help-zone-vb").hover(
            function () {
                $(this).tipsy("show");
            },
            function () {
                $(this).tipsy("hide");
            }
        );
    },
	formatData: function( data ) {
		// `d` is the original data object for the row
		var str = '';
		if(data){
			str += '<div class="datatablesubrow">'+
				'<table style="width: 100%;">'+
						'<tr>'+
							'<td class="text-left">'+jQuery.i18n.map["crashes.app_version"]+':</td>'+
							'<td class="text-left">'+jQuery.i18n.map["crashes.device"]+':</td>'+
							'<td class="text-left">'+jQuery.i18n.map["crashes.state"]+':</td>';
                            if(data.custom)
                                str += '<td class="text-left">'+jQuery.i18n.map["crashes.custom"]+':</td>';
                            if(data.logs)
                                str += '<td class="text-left">'+jQuery.i18n.map["crashes.logs"]+':</td>';
						str += '</tr>'+
						'<tr>'+
							'<td class="text-right">'+data.app_version.replace(/:/g, '.')+'</td>'+
							'<td class="text-right">'+data.os+' ';
                                if(data.os_version)
                                    str += data.os_version.replace(/:/g, '.')+'<br/>';
                                if(data.manufacture)
                                    str += data.manufacture;+' ';
                                if(data.manufacture)
                                    str += data.device;
                                if(data.cpu)
                                    str += ' ('+data.cpu+')'+'<br/>';
                                if(data.opengl)
                                    str += jQuery.i18n.map["crashes.opengl"]+': '+data.opengl+'<br/>';
                                if(data.resolution)
                                    str += jQuery.i18n.map["crashes.resolution"]+': '+data.resolution+'<br/>';
                                str += jQuery.i18n.map["crashes.root"]+': '+((data.root)? "yes" : "no")+'<br/>';
                            str += '</td>'+
                            '<td class="text-left">';
                                if(data.ram_current && data.ram_total)
                                    str += jQuery.i18n.map["crashes.ram"]+': '+data.ram_current+'/'+data.ram_total+' Mb<br/>';
                                if(data.disk_current && data.disk_total)
                                    str += jQuery.i18n.map["crashes.disk"]+': '+data.disk_current+'/'+data.disk_total+' Mb<br/>';
                                if(data.bat_current)
                                    str += jQuery.i18n.map["crashes.battery"]+': '+data.bat_current+'%<br/>';
                                if(data.run)
                                    str += jQuery.i18n.map["crashes.run"]+': '+countlyCommon.timeString(data.run/60)+'<br/>';
                                if(data.session)
                                    str += jQuery.i18n.map["crashes.after"]+' '+data.session+' '+jQuery.i18n.map["crashes.sessions"]+'<br/>';
                                else
                                    str += jQuery.i18n.map["crashes.frequency"]+': '+jQuery.i18n.map["crashes.first-crash"]+'<br/>';
                                str += jQuery.i18n.map["crashes.online"]+":"+((data.online)? "yes" : "no")+"<br/>";
                                str += jQuery.i18n.map["crashes.background"]+":"+((data.background)? "yes" : "no")+"<br/>";
                                str += jQuery.i18n.map["crashes.muted"]+":"+((data.muted)? "yes" : "no")+"<br/>";
                            str += '</td>';
                            if(data.custom){
                                str += '<td class="text-left">';
                                for(var i in data.custom){
                                    str += i+': '+data.custom[i]+'<br/>';
                                }
                                str += '</td>';
                            }
                            if(data.logs){
                                str += '<td class="text-left">'+
                                    '<pre>'+data.logs+'</pre>'+
                                '</td>';
                            }
						str += '</tr>'+
						'</table>'+
			'</div>';
		}
		return str;
	},
	switchMetric:function(metric){
		this.curMetric = metric;
		var crashData = countlyCrashes.getGroupData();
		countlyCommon.drawGraph(crashData.dp[this.curMetric], "#dashboard-graph", "bar");
	}
};
$(function() {
    $.fn.dataTableExt.oPagination.four_button = {
        "fnInit": function ( oSettings, nPaging, fnCallbackDraw )
        {
            nFirst = document.createElement( 'span' );
            nPrevious = document.createElement( 'span' );
            nNext = document.createElement( 'span' );
            nLast = document.createElement( 'span' );

            nFirst.innerHTML = "<i class='fa fa-angle-double-left'></i>";
            nPrevious.innerHTML = "<i class='fa fa-angle-left'></i>";
            nNext.innerHTML = "<i class='fa fa-angle-right'></i>";
            nLast.innerHTML = "<i class='fa fa-angle-double-right'></i>";

            nFirst.className = "paginate_button first";
            nPrevious.className = "paginate_button previous";
            nNext.className="paginate_button next";
            nLast.className = "paginate_button last";

            nPaging.appendChild( nFirst );
            nPaging.appendChild( nPrevious );
            nPaging.appendChild( nNext );
            nPaging.appendChild( nLast );

            $(nFirst).click( function () {
                oSettings.oApi._fnPageChange( oSettings, "first" );
                fnCallbackDraw( oSettings );
            } );

            $(nPrevious).click( function() {
                oSettings.oApi._fnPageChange( oSettings, "previous" );
                fnCallbackDraw( oSettings );
            } );

            $(nNext).click( function() {
                oSettings.oApi._fnPageChange( oSettings, "next" );
                fnCallbackDraw( oSettings );
            } );

            $(nLast).click( function() {
                oSettings.oApi._fnPageChange( oSettings, "last" );
                fnCallbackDraw( oSettings );
            } );

            $(nFirst).bind( 'selectstart', function () { return false; } );
            $(nPrevious).bind( 'selectstart', function () { return false; } );
            $(nNext).bind( 'selectstart', function () { return false; } );
            $(nLast).bind( 'selectstart', function () { return false; } );
        },

        "fnUpdate": function ( oSettings, fnCallbackDraw )
        {
            if ( !oSettings.aanFeatures.p )
            {
                return;
            }

            var an = oSettings.aanFeatures.p;
            for ( var i=0, iLen=an.length ; i<iLen ; i++ )
            {
                var buttons = an[i].getElementsByTagName('span');
                if ( oSettings._iDisplayStart === 0 )
                {
                    buttons[0].className = "paginate_disabled_previous";
                    buttons[1].className = "paginate_disabled_previous";
                }
                else
                {
                    buttons[0].className = "paginate_enabled_previous";
                    buttons[1].className = "paginate_enabled_previous";
                }

                if ( oSettings.fnDisplayEnd() == oSettings.fnRecordsDisplay() )
                {
                    buttons[2].className = "paginate_disabled_next";
                    buttons[3].className = "paginate_disabled_next";
                }
                else
                {
                    buttons[2].className = "paginate_enabled_next";
                    buttons[3].className = "paginate_enabled_next";
                }
            }
        }
    };
    $.fn.dataTableExt.oApi.fnStandingRedraw = function(oSettings) {
        if(oSettings.oFeatures.bServerSide === false){
            var before = oSettings._iDisplayStart;

            oSettings.oApi._fnReDraw(oSettings);

            // iDisplayStart has been reset to zero - so lets change it back
            oSettings._iDisplayStart = before;
            oSettings.oApi._fnCalculateEnd(oSettings);
        }

        // draw the 'current' page
        oSettings.oApi._fnDraw(oSettings);
    };
    $.extend($.fn.dataTable.defaults, {
        "sDom": '<"dataTable-top"fpT>t<"dataTable-bottom"i>',
        "bAutoWidth": false,
        "sPaginationType": "four_button",
        "iDisplayLength": 50,
        "bDestroy": true,
        "bDeferRender": true,
        "oTableTools": {
            "sSwfPath": countlyGlobal["cdn"]+"javascripts/dom/dataTables/swf/copy_csv_xls.swf",
            "aButtons": [
                {
                    "sExtends": "csv",
                    "sButtonText": "Save to CSV",
                    "fnClick": function (nButton, oConfig, flash) {
                        var tableCols = $(nButton).parents(".dataTables_wrapper").find(".dataTable").dataTable().fnSettings().aoColumns,
                            tableData = this.fnGetTableData(oConfig).split(/\r\n|\r|\n/g).join('","').split('","'),
                            retStr = "";

                        for (var i = 0;  i < tableData.length; i++) {
                            tableData[i] = tableData[i].replace("\"", "");

                            if (i >= tableCols.length) {
                                var colIndex = i % tableCols.length;

                                if (tableCols[colIndex].sType == "formatted-num") {
                                    tableData[i] = tableData[i].replace(/,/g, "");
                                } else if (tableCols[colIndex].sType == "percent") {
                                    tableData[i] = tableData[i].replace("%", "");
                                }
                            }

                            if ((i + 1) % tableCols.length == 0) {
                                retStr += "\"" + tableData[i] + "\"\r\n";
                            } else {
                                retStr += "\"" + tableData[i] + "\", ";
                            }
                        }

                        this.fnSetText(flash, retStr);
                    }
                },
                {
                    "sExtends": "xls",
                    "sButtonText": "Save for Excel",
                    "fnClick": function (nButton, oConfig, flash) {
                        var tableCols = $(nButton).parents(".dataTables_wrapper").find(".dataTable").dataTable().fnSettings().aoColumns,
                            tableData = this.fnGetTableData(oConfig).split(/\r\n|\r|\n/g).join('\t').split('\t'),
                            retStr = "";

                        for (var i = 0;  i < tableData.length; i++) {
                            if (i >= tableCols.length) {
                                var colIndex = i % tableCols.length;

                                if (tableCols[colIndex].sType == "formatted-num") {
                                    tableData[i] = parseFloat(tableData[i].replace(/,/g, "")).toLocaleString();
                                } else if (tableCols[colIndex].sType == "percent") {
                                    tableData[i] = parseFloat(tableData[i].replace("%", "")).toLocaleString();
                                } else if (tableCols[colIndex].sType == "numeric") {
                                    tableData[i] = parseFloat(tableData[i]).toLocaleString();
                                }
                            }

                            if ((i + 1) % tableCols.length == 0) {
                                retStr += tableData[i] + "\r\n";
                            } else {
                                retStr += tableData[i] + "\t";
                            }
                        }

                        this.fnSetText(flash, retStr);
                    }
                }
            ]
        },
        "fnInitComplete": function(oSettings, json) {
            var saveHTML = "<div class='save-table-data'><i class='fa fa-download'></i></div>",
                searchHTML = "<div class='search-table-data'><i class='fa fa-search'></i></div>",
                tableWrapper = $("#" + oSettings.sTableId + "_wrapper");

            $(saveHTML).insertBefore(tableWrapper.find(".DTTT_container"));
            $(searchHTML).insertBefore(tableWrapper.find(".dataTables_filter"));
            tableWrapper.find(".dataTables_filter").html(tableWrapper.find(".dataTables_filter").find("input").attr("Placeholder","Search").clone(true));

            tableWrapper.find(".save-table-data").on("click", function() {
                if ($(this).next(".DTTT_container").css('visibility') == 'hidden') {
                    $(this).next(".DTTT_container").css("visibility", 'visible');
                } else {
                    $(this).next(".DTTT_container").css("visibility", 'hidden');
                }
            });

            tableWrapper.find(".search-table-data").on("click", function() {
                $(this).next(".dataTables_filter").toggle();
                $(this).next(".dataTables_filter").find("input").focus();
            });

            tableWrapper.css({"min-height": tableWrapper.height()});
        }
    });

    $.fn.dataTableExt.sErrMode = 'throw';
    countlyCrashes.setGroupData(data);
    window.CrashgroupView.beforeRender();
});

    $(document).on('mouseenter', ".bar-inner", function(e) {
        var number = $(this).parent().next();

        number.text($(this).data("item"));
        number.css({"color":$(this).css("background-color")});
    });

    $(document).on('mouseleave', ".bar-inner", function(e) {
        var number = $(this).parent().next();

        number.text(number.data("item"));
        number.css({"color":$(this).parent().find(".bar-inner:first-child").css("background-color")});
    });
    </script>
</body>
</html>